<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<link rel="stylesheet" href="chat.css">
</head>
<body>

<div class="chat-container">
  <div class="chat-header">
    <div id="user-info">
      <img id="user-photo" src="" alt="User Photo">
      <span id="user-name"></span>
    </div>
    <button id="call-btn">ðŸ“ž Call</button>
  </div>

  <div id="chat-box" class="chat-box"></div>

  <div class="chat-input">
    <input type="text" id="message-input" placeholder="Type a message">
    <button id="send-btn">Send</button>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script src="app.js"></script>
</body>
</html>

<!-- âœ… FIREBASE + JS -->
<script type="module">
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyAygGBBR5HieXwdsL9f7M8uhaoh-mYHSuc",
        authDomain: "website-53417.firebaseapp.com",
        projectId: "website-53417",
        storageBucket: "website-53417.firebasestorage.app",
        messagingSenderId: "1049856174962",
        appId: "1:1049856174962:web:04fdd8707515fdbe6a8beb",
        measurementId: "G-WPEBYN7643"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const chatBox = document.getElementById('chat-box');
const sendBtn = document.getElementById('send-btn');
const messageInput = document.getElementById('message-input');
const userNameEl = document.getElementById('user-name');
const userPhotoEl = document.getElementById('user-photo');
const callBtn = document.getElementById('call-btn');

let currentUser;

// LOGIN CHECK
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    userNameEl.textContent = user.displayName || "No Name";
    userPhotoEl.src = user.photoURL || "https://via.placeholder.com/40";

    // Set call button
    callBtn.onclick = () => {
      if(user.phoneNumber){
        window.location.href = `tel:${user.phoneNumber}`;
      } else {
        alert("No phone number saved!");
      }
    };

    loadMessages();
  } else {
    // Redirect to login page
    window.location.href = "login.html";
  }
});

// SEND MESSAGE
sendBtn.addEventListener('click', () => {
  const text = messageInput.value.trim();
  if(text !== "") {
    db.collection('messages').add({
      uid: currentUser.uid,
      name: currentUser.displayName,
      photoURL: currentUser.photoURL,
      message: text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    messageInput.value = "";
  }
});

// LOAD MESSAGES
function loadMessages() {
  db.collection('messages').orderBy('timestamp')
    .onSnapshot(snapshot => {
      chatBox.innerHTML = "";
      snapshot.forEach(doc => {
        const msg = doc.data();
        const div = document.createElement('div');
        div.classList.add('message');
        div.classList.add(msg.uid === currentUser.uid ? 'my-message' : 'other-message');
        div.innerHTML = `
          <strong>${msg.name}</strong><br>
          ${msg.message}
          <span class="time">${msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleString() : ''}</span>
        `;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    });
}
</script>

</body>
</html>